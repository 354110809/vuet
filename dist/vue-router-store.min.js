!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.VueRouterStore=t.VueRouterStore||{})}(this,function(t){"use strict";function e(t){e.installed||(e.installed=!0,r=t,Object.defineProperty(t.prototype,"$vrs",{get:function(){return this.$root._vrs}}),Object.defineProperty(t.prototype,"$rs",{get:function(){return this.$root._vrs.store}}),t.mixin({beforeCreate:function(){o(this.$options.vrs)&&(this._vrs=this.$options.vrs)}}))}function n(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e={pagekey:"page",queryKey:"query",fetchBefore:function(){},fetchAfter:function(){},baseData:function(){return{}},baseListData:function(){return{}},baseDetailData:function(){return{}},fetchSuccess:function(t,e){},fetchError:function(t,e){},modules:{}};return Object.assign(e,t)}var r=null,o=function(t){return void 0!==t},i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},u=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},c=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),s=function(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t},a=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},f={isObject:function(t){return"[object Object]"===Object.prototype.toString.call(t)},isArray:function(t){return"[object Array]"===Object.prototype.toString.call(t)},isFunction:function(t){return"[object Function]"===Object.prototype.toString.call(t)},next:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(t){},r=!1,o=t(e,n);"object"===(void 0===o?"undefined":i(o))&&f.isFunction(o.then)&&o.then(function(t){r||(r=!0,e(t))}).catch(n)}},l={error:function(t){throw new Error("[vue-router-store] "+t)},warn:function(t){}},h=function(){function t(e){u(this,t),this.options=n(e=e||{}),this._init()}return c(t,[{key:"_init",value:function(){var t=this,e={},n={};Object.keys(this.options.modules).forEach(function(r){e[r]={list:t._getData(r,"list"),detail:t._getData(r,"detail")},n[r]={list:"",detail:""}}),this.store=new r({data:{store:e}}).$data.store,this._fetchKey=n}},{key:"_getModuleOptions",value:function(t,e){var n=this.options.modules[t],r={pagekey:this.options.pagekey,queryKey:this.options.queryKey,fetch:function(){return{}},data:function(){return{}}};return Object.keys(n).forEach(function(t){var o=t.split(e)[1]||"";(o=o.replace(/^(\w)/,function(t){return t.toLowerCase()}))&&(r[o]=n[t])}),r}},{key:"_returnComput",value:function(t,e){var n={};return e.length?(e.forEach(function(e){n[e]=t[e]}),n):t}},{key:"_getData",value:function(t,e){var n=this.options.baseData.call(this,t,e);switch(e){case"list":Object.assign(n,this.options.baseListData.call(this,t));break;case"detail":Object.assign(n,this.options.baseDetailData.call(this,t))}var r=this._getModuleOptions(t,e);return Object.assign(n,r.data.call(this))}},{key:"_clearStore",value:function(t,e){var n=this._getData(t,e);this._setStore(t,e,n)}},{key:"_getStore",value:function(t,e){return this.store[t][e]}},{key:"_setStore",value:function(t,e,n){var r=this.store[t][e];Object.assign(r,n)}},{key:"_getComputed",value:function(t,e){var n=this.store[t][e],r={};return Object.keys(n).forEach(function(t){r[t]={get:function(){return n[t]},set:function(e){n[t]=e}}}),r}},{key:"_setFetchKey",value:function(t,e,n){this._fetchKey[t][e]=String(n)}},{key:"_getFetchKey",value:function(t,e){return this._fetchKey[t][e]}},{key:"listStore",value:function(t){for(var e=this,n="list",r=e._getModuleOptions(t,n),o=a({},e._getComputed(t,n),{$rsList:function(){function o(){var r=e._getModuleOptions(t,n).fetch;if(!f.isFunction(r))return l.error(n+" fetch method is undefined");var o=u.$route.fullPath;e.options.fetchBefore.call(u,t,n),f.next(r.bind(u),function(r){var i=e.options.fetchSuccess.call(u,r,t,n);f.isObject(i)&&(r=i),o===u.$route.fullPath&&(e._setStore(t,n,r),e._setFetchKey(t,n,o),e.options.fetchAfter.call(u,t,n))},function(r){e.options.fetchError.call(u,r,t,n),e.options.fetchAfter.call(u,t,n)})}var u=this;return o.init=function(){e._clearStore(t,n)},o.search=function(){for(var t={},e=arguments.length,n=Array(e),o=0;o<e;o++)n[o]=arguments[o];"object"===("undefined"==typeof event?"undefined":i(event))&&event===n[0]&&(n[0]={}),f.isObject(n[0])?t=n[0]:"string"==typeof n[0]&&(t[n[0]]=n[1]),t=Object.assign({},u.$route.query,s({},r.pagekey,"1"),u[r.queryKey],t),u.$router.push(a({},u.$route,{query:t}))},o.syncQuery=function(){var t=u[r.queryKey];f.isObject(t)&&Object.keys(t).forEach(function(e){Object.prototype.hasOwnProperty.call(u.$route.query,e)&&(t[e]=u.$route.query[e])})},o}}),u=arguments.length,c=Array(u>1?u-1:0),h=1;h<u;h++)c[h-1]=arguments[h];return this._returnComput(o,c)}},{key:"listMixin",value:function(t){var e=this;return{beforeRouteEnter:function(n,r,o){var i=e._getFetchKey(t,"list"),u=n.fullPath;i?i!==u&&(e._clearStore(t,"list"),e._setFetchKey(t,"list",u)):e._setFetchKey(t,"list",u),f.isFunction(o)&&o()},computed:e.listStore(t),created:function(){this.$rsList.syncQuery(),this.$rsList()},watch:{"$route.fullPath":function(){this.$rsList.syncQuery(),this.$rsList()}}}}},{key:"detailStore",value:function(t){for(var e=this,n="detail",r=a({},e._getComputed(t,n),{$rsDetail:function(){function r(){var r=o.$route.path;if(r){var i=e._getModuleOptions(t,n).fetch;if(!f.isFunction(i))return l.error(n+" fetch method is undefined");e.options.fetchBefore.call(o,t,n),f.next(i.bind(o),function(i){var u=e.options.fetchSuccess.call(o,i,t,n);f.isObject(u)&&(i=u),r===o.$route.path&&(e._setStore(t,n,i),e._setFetchKey(t,n,r),e.options.fetchAfter.call(o,t,n))},function(r){e.options.fetchError.call(o,r,t,n),e.options.fetchAfter.call(o,t,n)})}}var o=this;return r.init=function(){e._clearStore(t,n)},r}}),o=arguments.length,i=Array(o>1?o-1:0),u=1;u<o;u++)i[u-1]=arguments[u];return this._returnComput(r,i)}},{key:"detailMixin",value:function(t){var e=this,n="detail";return{beforeRouteEnter:function(r,o,i){var u=e._getFetchKey(t,n);u?u&&u!==r.path&&(e._clearStore(t,n),e._setFetchKey(t,n,r.path)):e._setFetchKey(t,n,r.path),f.isFunction(i)&&i()},computed:e.detailStore(t),created:function(){this.$rsDetail()},watch:{"$route.path":function(){this.$rsDetail()}}}}}]),t}();h.install=e,t.default=h,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=vue-router-store.min.js.map
