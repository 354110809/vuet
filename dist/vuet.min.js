!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.Vuet=t.Vuet||{})}(this,function(t){"use strict";function e(t){e.installed||(e.installed=!0,a=t,Object.defineProperty(t.prototype,"$vuet",{get:function(){return this.$root._vuet}}),t.mixin({beforeCreate:function(){f(this.$options.vuet)&&(this._vuet=this.$options.vuet,this._vuet.init(this))},destroyed:function(){f(this.$options.vuet)&&(this._vuet=this.$options.vuet,this._vuet.destroy(this))}}),Object.keys(c).forEach(function(t){b.use(c[t])}))}function n(){var t=h.getArgMerge.apply(null,arguments),e={};return Object.keys(t).forEach(function(n){var i=t[n];e[n]={get:function(){return this.$vuet.store[i]},set:function(t){this.$vuet.store[i]=t}}}),e}function i(){for(var t=[],e=arguments.length,n=Array(e),i=0;i<e;i++)n[i]=arguments[i];return n.forEach(function(e){var n=e.split("/")[1],i=p[n];t.push(i.mixin(e))}),t}var o={name:"local",mixin:function(t){return{}}},r={name:"need",mixin:function(t){return{beforeCreate:function(){this.$vuet.fetch(t,{current:this})}}}},u={name:"once",mixin:function(t){return{beforeCreate:function(){var e=this;!1===this.$vuet.__once__&&this.$vuet.fetch(t,{current:this}).then(function(){e.$vuet.__once__=!0})}}},install:function(t,e){},init:function(t){t.__once__=!1},destroy:function(t){t.__once__=!0}},s={name:"route",mixin:function(t){function e(t,e,n){Object.defineProperty(t,e,{value:n,enumerable:!1,writable:!0,configurable:!1})}function n(){return this.$vuet._options.modules[t]}function i(t,e){"string"==typeof e&&(e=[e]);var n=function(t,e){return e.split(".").forEach(function(e){t=t[e]}),t},i=[];return e.forEach(function(e){var o=n(t,e);isNaN(o)||(o=String(o)),i.push(JSON.stringify(o))}),i}function o(t,e){for(var n=0;n<t.length;n++)if(t[n]!==e[n])return!0;return!1}return{beforeCreate:function(){var r=this;this.$vuet.__route__||e(this.$vuet,"__route__",{});var u=n.call(this),s=u.watch,c=void 0===s?"fullPath":s,a=i(this.$route,c);this.$vuet.__route__[t]||(this.$vuet.__route__[t]=a),o(a,this.$vuet.__route__[t])&&(this.$vuet.reset(t),this.$vuet.__route__[t]=a),this.$vuet.fetch(t,{current:this}).then(function(){r.$vuet.__route__[t]=a})},watch:{$route:{deep:!0,handler:function(e,r){var u=this,s=n.call(this),c=s.watch,a=void 0===c?"fullPath":c,f=i(e,a),h=i(r,a);if(!o(f,h))return!1;this.$vuet.fetch(t,this).then(function(){u.$vuet.__route__[t]=f})}}}}}},c={local:o,need:r,once:u,route:s},a=null,f=function(t){return void 0!==t},h={isObject:function(t){return"[object Object]"===Object.prototype.toString.call(t)},isFunction:function(t){return"[object Function]"===Object.prototype.toString.call(t)},forEachObj:function(t,e){h.isObject(t)&&Object.keys(t).forEach(function(n){e(t[n],n)})},getArgMerge:function(){var t={};return"string"==typeof arguments[0]?t[arguments[0]]=arguments[1]:h.isObject(arguments[0])&&(t=arguments[0]),t}},l={error:function(t){throw new Error("[vuet] "+t)},warn:function(t){}},v=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},_=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),p={},d=function(t,e){for(var n in p)h.isFunction(p[n][e])&&p[n][e](t)},b=function(){function t(e){v(this,t),h.isObject(e)||l.error("Parameter is the object type"),this.options=e||{},this.app=null,this.store={},this.beforeHooks=[],this.afterHooks=[],this.vm=null}return _(t,[{key:"beforeEach",value:function(t){this.beforeHooks.push(t)}},{key:"afterEach",value:function(t){this.afterHooks.push(t)}},{key:"init",value:function(t){var e=this;this.app||(this.app=t,this.vm=new a({data:{store:this.store}}),this._options={data:this.options.data||function(){return{}},modules:{}},h.forEachObj(this.options.modules,function(t,n){h.forEachObj(t,function(t,i){h.forEachObj(t,function(t,o){var r=n+"/"+i+"/"+o;e._options.modules[r]=e.options.modules[n][i][o],e.reset(r)})})}),d(this,"init"))}},{key:"setState",value:function(t,e){if(!this.store[t])return a.set(this.store,t,e);Object.assign(this.store[t],e)}},{key:"getState",value:function(t){return this.store[t]||{}}},{key:"reset",value:function(t){var e=this.options.data(),n=this._options.modules[t];h.isFunction(n.data)&&Object.assign(e,n.data.call(this,t)),this.setState(t,e)}},{key:"fetch",value:function(t,e){var n=this,i=this._options.modules[t];if(!h.isFunction(i.fetch))return!1;var o={path:t,params:e,store:this.getState(t)},r=function(t){for(var e=arguments.length,i=Array(e>1?e-1:0),o=1;o<e;o++)i[o-1]=arguments[o];for(var r=0;r<n[t].length;r++){var u;if((u=n[t][r]).call.apply(u,[n].concat(i)))return!1}};return!1===r("beforeHooks",o)?Promise.resolve(o.store):i.fetch.call(this).then(function(e){return!1===r("afterHooks",null,o,e)?o.store:(n.setState(t,e),o.store)}).catch(function(t){return!1===r("afterHooks",t,o)?Promise.resolve(o.store):Promise.reject(t)})}},{key:"destroy",value:function(){this.vm.$destroy(),d(this,"destroy")}}]),t}();b.use=function(t,e){return h.isFunction(t.install)&&t.install(a,b,e),"string"==typeof t.name||t.name?(p[t.name]=t,this):this},b.install=e,t.default=b,t.mapState=n,t.mapMixins=i,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=vuet.min.js.map
