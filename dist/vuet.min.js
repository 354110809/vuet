!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.Vuet=t.Vuet||{})}(this,function(t){"use strict";function e(t){e.installed||(e.installed=!0,u=t,Object.defineProperty(t.prototype,"$vuet",{get:function(){return this.$root._vuet}}),t.mixin({beforeCreate:function(){s.isUndefined(this.$options.vuet)||(this._vuet=this.$options.vuet,this._vuet._init(this))},destroyed:function(){s.isUndefined(this.$options.vuet)||(this._vuet=this.$options.vuet,this._vuet.destroy(this))}}))}function n(t,e){e.rule("life",c).rule("manual",f).rule("need",h).rule("once",v).rule("route",y)}function r(t){for(var e=$.options.rules,n=arguments.length,r=Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];for(var o in e)s.isFunction(e[o][t])&&e[o][t].apply(e[o],r)}var i=Object.prototype.toString,o=["Object","Function","String","Undefined","Null"],s={getArgMerge:function(){var t={},e=arguments;return s.isString(e[0])?t[e[0]]=e.length>1?e[1]:e[0]:e[0]&&s.isObject(e[0])&&(t=e[0]),t},set:function(t,e,n){Object.defineProperty(t,e,{value:n,enumerable:!1,writable:!0,configurable:!1})}};o.forEach(function(t){var e="[object "+t+"]";s["is"+t]=function(t){return i.call(t)===e}});var u=null,a={error:function(t){throw new Error("[vuet] "+t)},warn:function(t){}},c={rule:function(t){var e=t.path;return{beforeCreate:function(){this.$vuet.fetch(e,{current:this})},destroyed:function(){this.$vuet.reset(e,{current:this})}}}},f={rule:function(t){var e=t.path,n=t.name;return{beforeCreate:function(){var t=this,r=this.$vuet._options.modules[e].manuals,i={};if(Object.keys(r).forEach(function(n){var o=r[n];s.isFunction(o)&&(i[""+n]=function(){for(var n=arguments.length,r=Array(n),s=0;s<n;s++)r[s]=arguments[s];o.apply(i,[{state:t.$vuet.getState(e),vm:t,vuet:t.$vuet}].concat(r))})}),i.reset=function(){for(var n,r=arguments.length,i=Array(r),o=0;o<r;o++)i[o]=arguments[o];(n=t.$vuet).reset.apply(n,[e].concat(i))},i.fetch=function(){for(var n,r=arguments.length,i=Array(r),o=0;o<r;o++)i[o]=arguments[o];(n=t.$vuet).fetch.apply(n,[e].concat(i))},n)this[n]=i;else if(r.name)this[r.name]=i;else{var o=e.split(this.$vuet._options.pathJoin),u="$"+o[o.length-1],a=this[u]={};Object.assign(a,i)}}}}},h={rule:function(t){var e=t.path;return{beforeCreate:function(){this.$vuet.fetch(e,{current:this})}}}},l="__once__",v={init:function(t){s.set(t,l,{}),Object.keys(t.store).forEach(function(e){s.set(t[l],e,!1)})},rule:function(t){var e=t.path;return{beforeCreate:function(){var t=this;!1===this.$vuet[l][e]&&this.$vuet.fetch(e,{current:this}).then(function(){t.$vuet[l][e]=!0})}}}},p="__route__",y={init:function(t){s.set(t,p,{}),Object.keys(t.store).forEach(function(e){s.set(t[p],e,[])})},rule:function(t){function e(t,e){"string"==typeof e&&(e=[e]);var n=function(t,e){return e.split(".").forEach(function(e){t=t[e]}),t},r=[];return e.forEach(function(e){var i=n(t,e);isNaN(i)||(i=String(i)),r.push(JSON.stringify(i))}),r}function n(t,e){for(var n=0;n<t.length;n++)if(t[n]!==e[n])return!0;return!1}var r=t.path;return{beforeCreate:function(){var t=this,i=this.$vuet._options.modules[r].routeWatch,o=void 0===i?"fullPath":i,s=e(this.$route,o);n(s,this.$vuet[p][r])&&(this.$vuet.reset(r),this.$vuet[p][r]=s),this.$vuet.fetch(r,{current:this},!1).then(function(i){n(s,e(t.$route,o))||(t.$vuet.setState(r,i),t.$vuet[p][r]=s)})},watch:{$route:{deep:!0,handler:function(t,i){var o=this,s=this.$vuet._options.modules[r].routeWatch,u=void 0===s?"fullPath":s,a=e(t,u),c=e(i,u);if(!n(a,c))return!1;this.$vuet.fetch(r,{current:this}).then(function(t){n(a,e(o.$route,u))||(o.$vuet.setState(r,t),o.$vuet[p][r]=a)})}}}}}},d=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},b=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),g=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},m=function(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)},$=function(){function t(e){d(this,t),s.isObject(e)||a.error("Parameter is the object type"),this.options=e||{},this.app=null,this.store={},this.beforeHooks=[],this.afterHooks=[],this.vm=null}return b(t,[{key:"beforeEach",value:function(t){return this.beforeHooks.push(t),this}},{key:"afterEach",value:function(t){return this.afterHooks.push(t),this}},{key:"_init",value:function(t){var e=this;if(!this.app&&t){this.app=t,this.vm=new u({data:{store:this.store}}),this._options=g({data:function(){return{}},pathJoin:"/"},this.options,{modules:{}});var n=this._options.pathJoin,i=["data","fetch","routeWatch"];!function t(r,o){Object.keys(o).forEach(function(u){var a=o[u],c=[].concat(m(r),[u]);s.isFunction(a.data)&&(e._options.modules[c.join(n)]=a,e.reset(c.join(n))),-1===i.indexOf(u)&&s.isObject(a)&&t(c,a)})}([],this.options.modules),r("init",this)}}},{key:"getState",value:function(t){return this.store[t]||{}}},{key:"setState",value:function(t,e){return this.store[t]?(Object.assign(this.store[t],e),this):(u.set(this.store,t,e),this)}},{key:"fetch",value:function(t,e,n){var r=this,i=this._options.modules[t];if(!s.isFunction(i.fetch))return Promise.resolve(this.getState(t));var o={path:t,params:g({},e),state:this.getState(t)},u=function(t){for(var e=arguments.length,n=Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];for(var o=0;o<r[t].length;o++)if(r[t][o].apply(r,n))return!1};return!1===u("beforeHooks",o)?Promise.resolve(o.state):i.fetch.call(this,o).then(function(e){return!1===u("afterHooks",null,o,e)?o.state:!1===n?e:(r.setState(t,e),o.state)}).catch(function(t){return!1===u("afterHooks",t,o)?Promise.resolve(o.state):Promise.reject(t)})}},{key:"reset",value:function(t){var e=this._options.data.call(this),n=this._options.modules[t];return s.isFunction(n.data)&&Object.assign(e,n.data.call(this,t)),this.setState(t,e),this}},{key:"destroy",value:function(){this.vm.$destroy(),r("destroy",this)}}]),t}();Object.assign($,{options:{rules:{}},install:e,rule:function(t,e){return this.options.rules[t]?this:(this.options.rules[t]=e,r("install",u,$),this)},mapRules:function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];var r=s.getArgMerge.apply(null,arguments),i=[],o=function(t,e){var n=$.options.rules[t];"string"==typeof e?i.push(n.rule({path:e})):i.push(n.rule(e))};return Object.keys(r).forEach(function(t){var e=r[t];if(Array.isArray(e))return e.forEach(function(e){o(t,e)});o(t,e)}),{mixins:i}},mapModules:function(){var t=s.getArgMerge.apply(null,arguments),e={};return Object.keys(t).forEach(function(n){var r=t[n];e[n]={get:function(){return this.$vuet.store[r]},set:function(t){this.$vuet.store[r]=t}}}),{computed:e}},use:function(t,e){return s.isFunction(t)?t(u,$,e):s.isFunction(t.install)&&t.install(u,$,e),this}}),$.use(n);var j=$.mapRules.bind($),_=$.mapModules.bind($);t.mapRules=j,t.mapModules=_,t.default=$,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=vuet.min.js.map
