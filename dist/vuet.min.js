!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.Vuet=t.Vuet||{})}(this,function(t){"use strict";function e(t,e,n){var o=t.id,i=e.context,s=i.$vuet[c].scrolls[n];if(o&&i){s[o]||(s[o]={scrollTop:0,scrollLeft:0});var u=s[o];return setTimeout(function(){r(t,u)},0),u}}function r(t,e){"scrollTop"in t?Object.assign(t,e):t.scrollTo(e.scrollTop,e.scrollLeft)}function n(t){n.installed||(n.installed=!0,h=t,Object.defineProperty(t.prototype,"$vuet",{get:function(){return this.$root._vuet}}),t.mixin({beforeCreate:function(){a.isUndefined(this.$options.vuet)||(this._vuet=this.$options.vuet,this._vuet._init(this))},destroyed:function(){a.isUndefined(this.$options.vuet)||(this._vuet=this.$options.vuet,this._vuet.destroy(this))}}),t.directive("route-scroll",l))}function o(t,e){e.rule("life",p).rule("manual",d).rule("need",y).rule("once",b).rule("route",f)}function i(t){for(var e=O.options.rules,r=arguments.length,n=Array(r>1?r-1:0),o=1;o<r;o++)n[o-1]=arguments[o];for(var i in e)a.isFunction(e[i][t])&&e[i][t].apply(e[i],n)}var s=Object.prototype.toString,u=["Object","Function","String","Undefined","Null"],a={getArgMerge:function(){var t={},e=arguments;return a.isString(e[0])?t[e[0]]=e.length>1?e[1]:e[0]:e[0]&&a.isObject(e[0])&&(t=e[0]),t},set:function(t,e,r){Object.defineProperty(t,e,{value:r,enumerable:!1,writable:!0,configurable:!1})}};u.forEach(function(t){var e="[object "+t+"]";a["is"+t]=function(t){return s.call(t)===e}});var c="__route__",f={init:function(t){a.set(t,c,{watchers:{},scrolls:{}}),Object.keys(t.store).forEach(function(e){a.set(t[c].watchers,e,[]),a.set(t[c].scrolls,e,{})})},rule:function(t){function e(t){Object.keys(t[c].scrolls[u]).forEach(function(e){var n={scrollTop:0,scrollLeft:0};t[c].scrolls[u][e]=n;var o=document.getElementById(e);o&&r(o,n)})}function n(t){return t[c].watchers[u]}function o(t,e){t[c].watchers[u]=e}function i(t,e){"string"==typeof e&&(e=[e]);var r=function(t,e){return e.split(".").forEach(function(e){t=t[e]}),t},n=[];return e.forEach(function(e){var o=r(t,e);isNaN(o)||(o=String(o)),n.push(JSON.stringify(o))}),n}function s(t,e){for(var r=0;r<t.length;r++)if(t[r]!==e[r])return!0;return!1}var u=t.path;return{beforeCreate:function(){var t=this,r=this.$vuet._options.modules[u].routeWatch,a=void 0===r?"fullPath":r,c=i(this.$route,a);s(c,n(this.$vuet))&&(this.$vuet.reset(u),o(this.$vuet,c),e(this.$vuet)),this.$vuet.fetch(u,{current:this},!1).then(function(e){s(c,i(t.$route,a))||(t.$vuet.setState(u,e),o(t.$vuet,c))})},watch:{$route:{deep:!0,handler:function(t,r){var n=this,a=this.$vuet._options.modules[u].routeWatch,c=void 0===a?"fullPath":a,f=i(t,c),l=i(r,c);if(!s(f,l))return!1;this.$vuet.fetch(u,{current:this}).then(function(t){s(f,i(n.$route,c))||(e(n.$vuet),n.$vuet.setState(u,t),o(n.$vuet,f))})}}}}}},l={inserted:function(t,r,n){var o=r.value,i=e(t,n,o);t.__routeScroll__=function(t){var e=t.target,r=e.scrollTop,n=e.scrollLeft,o=e.pageXOffset,s=e.pageYOffset;i.scrollTop=r||o||r,i.scrollLeft=n||s||n},t.addEventListener("scroll",t.__routeScroll__,!1)},unbind:function(t){t.removeEventListener("scroll",t.__routeScroll__,!1),delete t.__routeScroll__}},h=null,v={error:function(t){throw new Error("[vuet] "+t)},warn:function(t){}},p={rule:function(t){var e=t.path;return{beforeCreate:function(){this.$vuet.fetch(e,{current:this})},destroyed:function(){this.$vuet.reset(e,{current:this})}}}},d={rule:function(t){var e=t.path,r=t.name;return{beforeCreate:function(){var t=this,n=this.$vuet._options.modules[e].manuals,o={};if(Object.keys(n).forEach(function(r){var i=n[r];a.isFunction(i)&&(o[""+r]=function(){for(var r=arguments.length,n=Array(r),s=0;s<r;s++)n[s]=arguments[s];i.apply(o,[{state:t.$vuet.getState(e),vm:t,vuet:t.$vuet}].concat(n))})}),o.reset=function(){for(var r,n=arguments.length,i=Array(n),s=0;s<n;s++)i[s]=arguments[s];return(r=t.$vuet).reset.apply(r,[e].concat(i)),o},o.fetch=function(){for(var r,n=arguments.length,i=Array(n),s=0;s<n;s++)i[s]=arguments[s];return(r=t.$vuet).fetch.apply(r,[e].concat(i)),o},r)this[r]=o;else if(n.name)this[n.name]=o;else{var i=e.split(this.$vuet._options.pathJoin),s="$"+i[i.length-1],u=this[s]={};Object.assign(u,o)}}}}},y={rule:function(t){var e=t.path;return{beforeCreate:function(){this.$vuet.fetch(e,{current:this})}}}},g="__once__",b={init:function(t){a.set(t,g,{}),Object.keys(t.store).forEach(function(e){a.set(t[g],e,!1)})},rule:function(t){var e=t.path;return{beforeCreate:function(){var t=this;!1===this.$vuet[g][e]&&this.$vuet.fetch(e,{current:this}).then(function(){t.$vuet[g][e]=!0})}}}},m=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},_=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),$=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},j=function(t){if(Array.isArray(t)){for(var e=0,r=Array(t.length);e<t.length;e++)r[e]=t[e];return r}return Array.from(t)},O=function(){function t(e){m(this,t),a.isObject(e)||v.error("Parameter is the object type"),this.options=e||{},this.app=null,this.store={},this.beforeHooks=[],this.afterHooks=[],this.vm=null}return _(t,[{key:"beforeEach",value:function(t){return this.beforeHooks.push(t),this}},{key:"afterEach",value:function(t){return this.afterHooks.push(t),this}},{key:"_init",value:function(t){var e=this;if(!this.app&&t){this.app=t,this.vm=new h({data:{store:this.store}}),this._options=$({data:function(){return{}}},this.options,{modules:{}});var r=["data","fetch","routeWatch","manuals"];!function t(n,o){Object.keys(o).forEach(function(i){var s=o[i],u=[].concat(j(n),[i]);if(a.isFunction(s.data)){for(var c=[u[0]],f=1;f<u.length;f++)c.push(u[f].replace(/^(\w)/,function(t){return t.toUpperCase()}));c=c.join(""),e._options.modules[c]=s,e.reset(c)}-1===r.indexOf(i)&&a.isObject(s)&&t(u,s)})}([],this.options.modules),i("init",this)}}},{key:"getState",value:function(t){return this.store[t]||{}}},{key:"setState",value:function(t,e){return this.store[t]?(Object.assign(this.store[t],e),this):(h.set(this.store,t,e),this)}},{key:"fetch",value:function(t,e,r){var n=this,o=this._options.modules[t];if(!a.isFunction(o.fetch))return Promise.resolve(this.getState(t));var i={path:t,params:$({},e),state:this.getState(t)},s=function(t){for(var e=arguments.length,r=Array(e>1?e-1:0),o=1;o<e;o++)r[o-1]=arguments[o];for(var i=0;i<n[t].length;i++)if(n[t][i].apply(n,r))return!1};return!1===s("beforeHooks",i)?Promise.resolve(i.state):o.fetch.call(this,i).then(function(e){return!1===s("afterHooks",null,i,e)?i.state:!1===r?e:(n.setState(t,e),i.state)}).catch(function(t){return!1===s("afterHooks",t,i)?Promise.resolve(i.state):Promise.reject(t)})}},{key:"reset",value:function(t){var e=this._options.data.call(this),r=this._options.modules[t];return a.isFunction(r.data)&&Object.assign(e,r.data.call(this,t)),this.setState(t,e),this}},{key:"destroy",value:function(){this.vm.$destroy(),i("destroy",this)}}]),t}();Object.assign(O,{options:{rules:{}},install:n,rule:function(t,e){return this.options.rules[t]?this:(this.options.rules[t]=e,i("install",h,O),this)},mapRules:function(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];var n=a.getArgMerge.apply(null,arguments),o=[],i=function(t,e){var r=O.options.rules[t];"string"==typeof e?o.push(r.rule({path:e})):o.push(r.rule(e))};return Object.keys(n).forEach(function(t){var e=n[t];if(Array.isArray(e))return e.forEach(function(e){i(t,e)});i(t,e)}),{mixins:o}},mapModules:function(){var t=a.getArgMerge.apply(null,arguments),e={};return Object.keys(t).forEach(function(r){var n=t[r];e[r]={get:function(){return this.$vuet.store[n]},set:function(t){this.$vuet.store[n]=t}}}),{computed:e}},use:function(t,e){return a.isFunction(t)?t(h,O,e):a.isFunction(t.install)&&t.install(h,O,e),this}}),O.use(o);var k=O.mapRules.bind(O),E=O.mapModules.bind(O);t.mapRules=k,t.mapModules=E,t.default=O,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=vuet.min.js.map
