!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.Vuet=t.Vuet||{})}(this,function(t){"use strict";function e(t){e.installed||(e.installed=!0,v=t,Object.defineProperty(t.prototype,"$vuet",{get:function(){return this.$root._vuet}}),t.mixin({beforeCreate:function(){u.isUndefined(this.$options.vuet)||(this._vuet=this.$options.vuet,this._vuet.init(this))},destroyed:function(){u.isUndefined(this.$options.vuet)||(this._vuet=this.$options.vuet,this._vuet.destroy(this))}}),Object.keys(l).forEach(function(t){g.use(l[t])}))}function n(){var t=u.getArgMerge.apply(null,arguments),e={};return Object.keys(t).forEach(function(n){var i=t[n];e[n]={get:function(){return this.$vuet.store[i]},set:function(t){this.$vuet.store[i]=t}}}),e}function i(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];var i=u.getArgMerge.apply(null,arguments),r=[];return Object.keys(i).forEach(function(t){var e=i[t];if(Array.isArray(e))return e.forEach(function(e){var n=g.plugins[t];r.push(n.mixin(e))});var n=g.plugins[t];r.push(n.mixin(e))}),r}var r=Object.prototype.toString,o=["Object","Function","String","Undefined","Null"],u={forEachObj:function(t,e){t&&u.isObject(t)&&Object.keys(t).forEach(function(n){e(t[n],n)})},getArgMerge:function(){var t={},e=arguments;return u.isString(e[0])?t[e[0]]=e.length>1?e[1]:e[0]:e[0]&&u.isObject(e[0])&&(t=e[0]),t}};o.forEach(function(t){var e="[object "+t+"]";u["is"+t]=function(t){return r.call(t)===e}});var s={name:"life",mixin:function(t){return{beforeCreate:function(){this.$vuet.fetch(t,{current:this})},destroyed:function(){this.$vuet.reset(t,{current:this})}}}},a={name:"local",mixin:function(t){return{}}},f={name:"need",mixin:function(t){return{beforeCreate:function(){this.$vuet.fetch(t,{current:this})}}}},c={name:"once",mixin:function(t){return{beforeCreate:function(){var e=this;!1===this.$vuet.__fired_once__&&this.$vuet.fetch(t,{current:this}).then(function(){e.$vuet.__fired_once__=!0})}}},init:function(t){t.__fired_once__=!1},destroy:function(t){t.__fired_once__=!0}},h={name:"route",mixin:function(t){function e(t,e,n){Object.defineProperty(t,e,{value:n,enumerable:!1,writable:!0,configurable:!1})}function n(t,e){"string"==typeof e&&(e=[e]);var n=function(t,e){return e.split(".").forEach(function(e){t=t[e]}),t},i=[];return e.forEach(function(e){var r=n(t,e);isNaN(r)||(r=String(r)),i.push(JSON.stringify(r))}),i}function i(t,e){for(var n=0;n<t.length;n++)if(t[n]!==e[n])return!0;return!1}return{beforeCreate:function(){var r=this;this.$vuet.__route__||e(this.$vuet,"__route__",{});var o=this.$vuet._options.modules[t].watch,u=void 0===o?"fullPath":o,s=n(this.$route,u);this.$vuet.__route__[t]||(this.$vuet.__route__[t]=s),i(s,this.$vuet.__route__[t])&&(this.$vuet.reset(t),this.$vuet.__route__[t]=s),this.$vuet.fetch(t,{current:this}).then(function(){r.$vuet.__route__[t]=s})},watch:{$route:{deep:!0,handler:function(e,r){var o=this,u=this.$vuet._options.modules[t].watch,s=void 0===u?"fullPath":u,a=n(e,s),f=n(r,s);if(!i(a,f))return!1;this.$vuet.fetch(t,this).then(function(){o.$vuet.__route__[t]=a})}}}}}},l={life:s,local:a,need:f,once:c,route:h},v=null,p={error:function(t){throw new Error("[vuet] "+t)},warn:function(t){}},_=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},d=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),y=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t},g=function(){function t(e){_(this,t),u.isObject(e)||p.error("Parameter is the object type"),this.options=e||{},this.app=null,this.store={},this.beforeHooks=[],this.afterHooks=[],this.vm=null}return d(t,[{key:"beforeEach",value:function(t){this.beforeHooks.push(t)}},{key:"afterEach",value:function(t){this.afterHooks.push(t)}},{key:"init",value:function(e){var n=this;!this.app&&e&&(this.app=e,this.vm=new v({data:{store:this.store}}),this._options={data:this.options.data||function(){return{}},modules:{}},u.forEachObj(this.options.modules,function(t,e){u.forEachObj(t,function(t,i){var r=e+"/"+i;n._options.modules[r]=n.options.modules[e][i],n.reset(r)})}),t.pluginCallHook(this,"init"))}},{key:"setState",value:function(t,e){if(!this.store[t])return v.set(this.store,t,e);Object.assign(this.store[t],e)}},{key:"getState",value:function(t){return this.store[t]||{}}},{key:"reset",value:function(t){var e=this.options.data.call(this),n=this._options.modules[t];u.isFunction(n.data)&&Object.assign(e,n.data.call(this,t)),this.setState(t,e)}},{key:"fetch",value:function(t,e){var n=this,i=this._options.modules[t];if(!u.isFunction(i.fetch))return!1;var r={path:t,params:y({},e),store:this.getState(t)},o=function(t){for(var e=arguments.length,i=Array(e>1?e-1:0),r=1;r<e;r++)i[r-1]=arguments[r];for(var o=0;o<n[t].length;o++)if(n[t][o].apply(n,i))return!1};return!1===o("beforeHooks",r)?Promise.resolve(r.store):i.fetch.call(this,r).then(function(e){return!1===o("afterHooks",null,r,e)?r.store:(n.setState(t,e),r.store)}).catch(function(t){return!1===o("afterHooks",t,r)?Promise.resolve(r.store):Promise.reject(t)})}},{key:"destroy",value:function(){this.vm.$destroy(),t.pluginCallHook(this,"destroy")}}]),t}();g.plugins={},g.pluginCallHook=function(t,e){for(var n in g.plugins)u.isFunction(g.plugins[n][e])&&g.plugins[n][e](t)},g.use=function(t,e){return u.isFunction(t.install)&&t.install(v,g,e),"string"==typeof t.name&&t.name?(g.plugins[t.name]=t,g):g},g.install=e,t.default=g,t.mapState=n,t.mapMixins=i,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=vuet.min.js.map
