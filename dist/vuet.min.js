!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.Vuet=t.Vuet||{})}(this,function(t){"use strict";function e(t){e.installed||(e.installed=!0,u=t,Object.defineProperty(t.prototype,"$vuet",{get:function(){return this.$root._vuet}}),t.mixin({beforeCreate:function(){s.isUndefined(this.$options.vuet)||(this._vuet=this.$options.vuet,this._vuet._init(this))},destroyed:function(){s.isUndefined(this.$options.vuet)||(this._vuet=this.$options.vuet,this._vuet.destroy(this))}}))}function n(){var t=s.getArgMerge.apply(null,arguments),e={};return Object.keys(t).forEach(function(n){var i=t[n];e[n]={get:function(){return this.$vuet.store[i]},set:function(t){this.$vuet.store[i]=t}}}),e}function i(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];var i=s.getArgMerge.apply(null,arguments),r=[];return Object.keys(i).forEach(function(t){var e=i[t];if(Array.isArray(e))return e.forEach(function(e){var n=$.plugins[t];r.push(n.mixin(e))});var n=$.plugins[t];r.push(n.mixin(e))}),r}var r=Object.prototype.toString,o=["Object","Function","String","Undefined","Null"],s={getArgMerge:function(){var t={},e=arguments;return s.isString(e[0])?t[e[0]]=e.length>1?e[1]:e[0]:e[0]&&s.isObject(e[0])&&(t=e[0]),t},set:function(t,e,n){Object.defineProperty(t,e,{value:n,enumerable:!1,writable:!0,configurable:!1})}};o.forEach(function(t){var e="[object "+t+"]";s["is"+t]=function(t){return r.call(t)===e}});var u=null,a={error:function(t){throw new Error("[vuet] "+t)},warn:function(t){}},f={name:"life",mixin:function(t){return{beforeCreate:function(){this.$vuet.fetch(t,{current:this})},destroyed:function(){this.$vuet.reset(t,{current:this})}}}},c={name:"need",mixin:function(t){return{beforeCreate:function(){this.$vuet.fetch(t,{current:this})}}}},h="__once__",l={name:"once",init:function(t){s.set(t,h,{}),Object.keys(t.store).forEach(function(e){s.set(t[h],e,!1)})},mixin:function(t){return{beforeCreate:function(){var e=this;!1===this.$vuet[h][t]&&this.$vuet.fetch(t,{current:this}).then(function(){e.$vuet[h][t]=!0})}}}},v="__route__",p={name:"route",init:function(t){s.set(t,v,{}),Object.keys(t.store).forEach(function(e){s.set(t[v],e,[])})},mixin:function(t){function e(t,e){"string"==typeof e&&(e=[e]);var n=function(t,e){return e.split(".").forEach(function(e){t=t[e]}),t},i=[];return e.forEach(function(e){var r=n(t,e);isNaN(r)||(r=String(r)),i.push(JSON.stringify(r))}),i}function n(t,e){for(var n=0;n<t.length;n++)if(t[n]!==e[n])return!0;return!1}return{beforeCreate:function(){var i=this,r=this.$vuet._options.modules[t].routeWatch,o=void 0===r?"fullPath":r,s=e(this.$route,o);n(s,this.$vuet[v][t])&&(this.$vuet.reset(t),this.$vuet[v][t]=s),this.$vuet.fetch(t,{current:this},!1).then(function(r){n(s,e(i.$route,o))||(i.$vuet.setState(t,r),i.$vuet[v][t]=s)})},watch:{$route:{deep:!0,handler:function(i,r){var o=this,s=this.$vuet._options.modules[t].routeWatch,u=void 0===s?"fullPath":s,a=e(i,u),f=e(r,u);if(!n(a,f))return!1;this.$vuet.fetch(t,{current:this}).then(function(i){n(a,e(o.$route,u))||(o.$vuet.setState(t,i),o.$vuet[v][t]=a)})}}}}}},d={life:f,need:c,once:l,route:p},y=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},g=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),m=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t},b=function(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)},$=function(){function t(e){y(this,t),s.isObject(e)||a.error("Parameter is the object type"),this.options=e||{},this.app=null,this.store={},this.beforeHooks=[],this.afterHooks=[],this.vm=null}return g(t,[{key:"beforeEach",value:function(t){return this.beforeHooks.push(t),this}},{key:"afterEach",value:function(t){return this.afterHooks.push(t),this}},{key:"_init",value:function(e){var n=this;if(!this.app&&e){this.app=e,this.vm=new u({data:{store:this.store}}),this._options={data:this.options.data||function(){return{}},pathJoin:this.options.pathJoin||"/",modules:{}};var i=this._options.pathJoin,r=["data","fetch","routeWatch"];!function t(e,o){Object.keys(o).forEach(function(u){var a=o[u],f=[].concat(b(e),[u]);s.isFunction(a.data)&&(n._options.modules[f.join(i)]=a,n.reset(f.join(i))),-1===r.indexOf(u)&&s.isObject(a)&&t(f,a)})}([],this.options.modules),t.pluginCallHook("init",this)}}},{key:"getState",value:function(t){return this.store[t]||{}}},{key:"setState",value:function(t,e){return this.store[t]?(Object.assign(this.store[t],e),this):(u.set(this.store,t,e),this)}},{key:"fetch",value:function(t,e,n){var i=this,r=this._options.modules[t];if(!s.isFunction(r.fetch))return Promise.resolve(this.getState(t));var o={path:t,params:m({},e),state:this.getState(t)},u=function(t){for(var e=arguments.length,n=Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];for(var o=0;o<i[t].length;o++)if(i[t][o].apply(i,n))return!1};return!1===u("beforeHooks",o)?Promise.resolve(o.state):r.fetch.call(this,o).then(function(e){return!1===u("afterHooks",null,o,e)?o.state:!1===n?e:(i.setState(t,e),o.state)}).catch(function(t){return!1===u("afterHooks",t,o)?Promise.resolve(o.state):Promise.reject(t)})}},{key:"reset",value:function(t){var e=this._options.data.call(this),n=this._options.modules[t];return s.isFunction(n.data)&&Object.assign(e,n.data.call(this,t)),this.setState(t,e),this}},{key:"destroy",value:function(){this.vm.$destroy(),t.pluginCallHook("destroy",this)}}]),t}();$.plugins=m({},d),$.pluginCallHook=function(t){for(var e=arguments.length,n=Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];for(var r in $.plugins)s.isFunction($.plugins[r][t])&&$.plugins[r][t].apply($.plugins[r],n)},$.use=function(t,e){return s.isFunction(t.install)&&t.install(u,$,e),"string"==typeof t.name&&t.name?($.plugins[t.name]=t,$):$},$.mapState=n,$.mapMixins=i,$.install=e;var _=$.mapMixins,j=$.mapState;t.mapMixins=_,t.mapState=j,t.default=$,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=vuet.min.js.map
